@page "{id}"
@using Letterbook.Core.Values
@model Profile

@{
    ViewData["Title"] = $"{Model.DisplayName} ({Model.FullHandle})";
}

<section class="profile">
    <header >
        <img src="/img/letterbook-banner-dark.png" alt="user provided alt text" class="banner"/>
        <h1>
            <span>@Model.DisplayName</span>
        </h1>
        <span>@Model.FullHandle</span>
    </header>
    <div class="profile-controls">
        @if (User.Identity?.IsAuthenticated == true && Model.SelfId == Model.GetId)
        {
            <a asp-area="Profile" asp-page="Edit" asp-route-id="@Model.SelfId">Edit</a>
        }
        else if (Model.UserProfile != null)
        {
            switch (Model.YouFollow)
            {
                case FollowState.Accepted:
                    <form asp-page-handler="Unfollow" asp-route-followId="@Model.GetId" method="post">
                        <button type="submit">Unfollow</button>
                    </form>
                    break;
                case FollowState.None:
                    <form asp-page-handler="FollowRequest" asp-route-followId="@Model.GetId" method="post">
                        <button type="submit">Follow</button>
                    </form>
                    break;
                case FollowState.Pending:
                    <form asp-page-handler="Unfollow" asp-route-followId="@Model.GetId" method="post">
                        <button type="submit">Cancel Follow Request</button>
                    </form>
                    break;
                case FollowState.Rejected:
                case FollowState.Blocked:
                default:
                    throw new ArgumentOutOfRangeException();
            }

            <div class="menu-collapsible-right" role="menu">
                <label class="collapse-control icon-more">
                    <input type="checkbox"/>
                </label>
                <div class="menu-items">
                    <a href="/">Report</a>
                    <a href="/">Other Stuff</a>
                </div>
            </div>
        }
    </div>
    <div class="profile-stats">
        @if (Model.Blocked)
        {
            <p>You are blocked by this user profile</p>
        }
        else
        {
            <p>Joined <time datetime="@Model.CreatedDate.ToString("yyyy-MM-dd")">
                @Model.CreatedDate.ToString("M") @Model.CreatedDate.ToString("yyyy")
            </time></p>
            <p>@Model.FollowerCount followers</p>
            <p>@Model.FollowingCount following</p>
            <p>@Model.PostCount posts</p>
            @if (User.Identity?.IsAuthenticated == true && Model.SelfId != Model.GetId)
            {
                @switch (Model.FollowsYou)
                {
                    case FollowState.Accepted:
                        <form asp-page-handler="RemoveFollower" asp-route-followerId="@Model.GetId" method="post">
                            <span>Follows you</span>
                            <button type="submit" class="secondary">Remove follower</button>
                        </form>
                        break;
                    case FollowState.Pending:
                        <form asp-page-handler="AcceptFollower" asp-route-followerId="@Model.GetId" method="post">
                            <p>Requested to follow you</p>
                            <button type="submit" name="action" value="accept">Accept</button>
                            <button type="submit" name="action" value="reject" class="secondary">Reject</button>
                        </form>
                        break;
                    case FollowState.Blocked:
                        <p class="secondary">Blocked</p>
                        break;
                    case FollowState.None:
                    case FollowState.Rejected:
                    default:
                        break;
                }
            }
        }
    </div>
</section>
<div>
    <h1>
        <span>@Model.DisplayName</span>
        <span>@Model.FullHandle</span>
    </h1>

    <div>
        <h3>Description</h3>
        <div>@Model.Description</div>
        
        <h3>Custom Fields</h3>
        <dl>
            @foreach (var field in Model.CustomFields) {
                <dt>@field.Label</dt>
                <dd>@field.Value</dd>
            }
        </dl>
        
        <h3>Info</h3>
        <div>
            <div>
                @Model.FollowerCount Followers
            </div>
            <div>
                @Model.FollowingCount Following
            </div>
        </div>
        
    </div>
    
    <p>Profile Id: <code>@Model.GetId</code></p>
    
</div>
